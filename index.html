<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Controle de Medicamentos</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    </head>
<body>
    <!-- Tela de Login -->
    <div class="login-container" id="loginContainer">
        <div class="login-form">
            <h2><i class="fas fa-pills"></i> Controle de Medicamentos</h2>
            <div class="form-group">
                <input type="number" id="userId" placeholder="Digite seu ID de usuário" min="1">
            </div>
            <button class="btn" onclick="login()">Entrar <i class="fas fa-sign-in-alt"></i></button>
        </div>
    </div>
    
    <!-- Modal de Alerta -->
    <div class="modal" id="alertModal">
        <div class="modal-content">
            <h3 id="alertTitle">Alerta</h3>
            <p id="alertMessage"></p>
            <div class="modal-buttons">
                <button class="modal-btn modal-btn-ok" onclick="confirmarEnvioEmail()">Sim</button>
                <button class="modal-btn modal-btn-cancel" onclick="closeAlert()">Não</button>
            </div>
        </div>
    </div>
    
    <!-- Scanner de Código de Barras -->
    <div class="scanner-container" id="scannerContainer">
        <video class="scanner-video" id="scannerVideo"></video>
        <div class="scanner-overlay"></div>
        <button class="scanner-close" onclick="fecharScanner()">&times;</button>
    </div>
    
    <!-- Sistema Principal -->
    <div class="app-container" id="appContainer">
        <!-- Menu Lateral -->
        <div class="sidebar" id="sidebar">
            <div class="user-info">
                <div class="avatar">
                    <i class="fas fa-user-circle fa-3x"></i>
                </div>
                <h3 id="userName">Usuário</h3>
                <p>ID: <span id="userIdDisplay">000</span> <span id="userTypeBadge"></span></p>
            </div>
            
            <ul class="menu">
                <li class="active" data-module="dashboard"><i class="fas fa-home"></i> Dashboard</li>
                <li data-module="cadastrar" id="menuCadastrar"><i class="fas fa-plus-circle"></i> Cadastrar Medicamento</li>
                <li data-module="retirar"><i class="fas fa-minus-circle"></i> Retirar/Devolver</li>
                <li data-module="pesquisar"><i class="fas fa-search"></i> Pesquisar</li>
                <li data-module="relatorios" id="menuRelatorios"><i class="fas fa-chart-bar"></i> Relatórios</li>
                <li data-module="usuarios" id="menuUsuarios"><i class="fas fa-users"></i> Usuários</li>
                <li data-module="configuracoes" id="menuConfiguracoes"><i class="fas fa-cog"></i> Configurações</li>
                <li data-module="sair" onclick="logout()"><i class="fas fa-sign-out-alt"></i> Sair</li>
            </ul>
        </div>
        
        <!-- Conteúdo Principal -->
        <div class="main-content">
            <div class="header">
                <button class="menu-toggle" onclick="toggleMenu()">
                    <i class="fas fa-bars"></i> Menu
                </button>
                <h1 id="moduleTitle">Dashboard</h1>
                <button class="logout-btn" onclick="logout()"><i class="fas fa-sign-out-alt"></i> Sair</button>
            </div>
            
            <!-- Dashboard -->
            <div class="module active" id="dashboard">
                <h2>Resumo do Estoque</h2>
                <div class="form-row">
                    <div class="form-group">
                        <div class="stat-card" style="background: #e8f4fc; padding: 20px; border-radius: 8px; text-align: center;">
                            <h3 id="totalMedicamentos">0</h3>
                            <p>Medicamentos Cadastrados</p>
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="stat-card" style="background: #e6f7ee; padding: 20px; border-radius: 8px; text-align: center;">
                            <h3 id="totalValor">R$ 0,00</h3>
                            <p>Valor Total em Estoque</p>
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="stat-card" style="background: #fef5e7; padding: 20px; border-radius: 8px; text-align: center;">
                            <h3 id="proximosVencimentos">0</h3>
                            <p>Próximos Vencimentos</p>
                        </div>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <div class="stat-card" style="background: #fde8e8; padding: 20px; border-radius: 8px; text-align: center;">
                            <h3 id="totalGastoMes">R$ 0,00</h3>
                            <p>Total Gasto no Mês</p>
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="stat-card" style="background: #e0f7fa; padding: 20px; border-radius: 8px; text-align: center;">
                            <h3 id="medicamentoMaisUtilizado">-</h3>
                            <p>Medicamento Mais Utilizado</p>
                        </div>
                    </div>
                </div>
                
                <h2>Últimas Movimentações</h2>
                <div class="table-container">
                    <table id="movimentacoesTable">
                        <thead>
                            <tr>
                                <th>Data</th>
                                <th>Medicamento</th>
                                <th>Lote</th>
                                <th>Quantidade</th>
                                <th>Valor Total</th>
                                <th>Usuário</th>
                                <th>Tipo</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Preenchido via JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Cadastrar Medicamento -->
            <div class="module" id="cadastrar">
                <h2>Cadastrar Novo Medicamento</h2>
                <div class="form-row">
                    <div class="form-group">
                        <label for="codigoBarras">Código de Barras</label>
                        <input type="text" id="codigoBarras" placeholder="Digite ou escaneie o código">
                        <button class="scan-btn" onclick="iniciarScanner('codigoBarras')"><i class="fas fa-barcode"></i> Escanear Código</button>
                        <button class="scan-btn" onclick="simularScan('codigoBarras')" style="background: var(--accent);"><i class="fas fa-qrcode"></i> Simular Scan</button>
                    </div>
                    <div class="form-group">
                        <label for="nomeMedicamento">Nome do Medicamento</label>
                        <input type="text" id="nomeMedicamento" placeholder="Nome do medicamento">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="fabricante">Fabricante</label>
                        <input type="text" id="fabricante" placeholder="Fabricante">
                    </div>
                    <div class="form-group">
                        <label for="lote">Lote</label>
                        <input type="text" id="lote" placeholder="Número do lote">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="quantidade">Quantidade</label>
                        <input type="number" id="quantidade" min="1" placeholder="Quantidade" oninput="calcularValorUnitario()">
                    </div>
                    <div class="form-group">
                        <label for="valorTotal">Valor Total (R$)</label>
                        <input type="number" id="valorTotal" min="0.01" step="0.01" placeholder="Valor total pago" oninput="calcularValorUnitario()">
                        <div class="valor-info" id="valorUnitarioInfo">Valor unitário: R$ 0,00</div>
                    </div>
                    <div class="form-group">
                        <label for="validade">Data de Validade</label>
                        <input type="date" id="validade">
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="observacoes">Observações</label>
                    <textarea id="observacoes" rows="3" placeholder="Observações adicionais"></textarea>
                </div>
                
                <button class="btn" onclick="cadastrarMedicamento()">Cadastrar Medicamento</button>
            </div>
            
            <!-- Retirar/Devolver Medicamento -->
            <div class="module" id="retirar">
                <h2>Retirar/Devolver Medicamento</h2>
                <div class="form-row">
                    <div class="form-group">
                        <label for="retirarCodigo">Código de Barras</label>
                        <input type="text" id="retirarCodigo" placeholder="Digite ou escaneie o código" oninput="buscarMedicamentoPorCodigo(this.value)">
                        <button class="scan-btn" onclick="iniciarScanner('retirarCodigo')"><i class="fas fa-barcode"></i> Escanear Código</button>
                        <button class="scan-btn" onclick="simularScan('retirarCodigo')" style="background: var(--accent);"><i class="fas fa-qrcode"></i> Simular Scan</button>
                    </div>
                    <div class="form-group">
                        <label for="medicamentoRetirada">Medicamento</label>
                        <input type="text" id="medicamentoRetirada" readonly>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="loteRetirada">Lote</label>
                        <input type="text" id="loteRetirada" readonly>
                    </div>
                    <div class="form-group">
                        <label for="quantidadeRetirada">Quantidade</label>
                        <input type="number" id="quantidadeRetirada" min="1" placeholder="Quantidade" oninput="calcularValorTotalRetirada()">
                    </div>
                    <div class="form-group">
                        <label for="valorUnitarioRetirada">Valor Unitário (R$)</label>
                        <input type="text" id="valorUnitarioRetirada" readonly>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="tipoMovimentacao">Tipo de Movimentação</label>
                        <select id="tipoMovimentacao" onchange="toggleMotivoField()">
                            <option value="saida">Retirada</option>
                            <option value="devolucao">Devolução</option>
                        </select>
                    </div>
                    <div class="form-group" id="motivoField">
                        <label for="motivoRetirada">Motivo da Retirada</label>
                        <select id="motivoRetirada">
                            <option value="uso">Uso Interno</option>
                            <option value="venda">Venda</option>
                            <option value="descarte">Descarte</option>
                            <option value="outro">Outro</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <div class="valor-info" id="valorTotalRetiradaInfo">Valor total: R$ 0,00</div>
                </div>
                
                <button class="btn" onclick="processarMovimentacao()">Confirmar</button>
            </div>
            
            <!-- Pesquisar Medicamento -->
            <div class="module" id="pesquisar">
                <h2>Pesquisar Medicamentos</h2>
                <div class="form-group">
                    <label for="termoPesquisa">Digite para pesquisar</label>
                    <input type="text" id="termoPesquisa" placeholder="Nome, código ou lote" oninput="pesquisarMedicamentos(this.value)">
                </div>
                
                <div class="table-container">
                    <table id="resultadosPesquisa">
                        <thead>
                            <tr>
                                <th>Código</th>
                                <th>Nome</th>
                                <th>Lote</th>
                                <th>Quantidade</th>
                                <th>Validade</th>
                                <th>Valor Unit.</th>
                                <th id="thAcoes">Ações</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Preenchido via JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Relatórios -->
            <div class="module" id="relatorios">
                <h2>Relatórios 
                    <button class="export-btn" onclick="exportarParaExcel()">
                        <i class="fas fa-file-excel"></i> Exportar para Excel
                    </button>
                </h2>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="relatorioTipo">Tipo de Relatório</label>
                        <select id="relatorioTipo" onchange="mudarTipoRelatorio()">
                            <option value="vencimentos">Próximos Vencimentos</option>
                            <option value="estoque">Estoque Baixo</option>
                            <option value="movimentacoes">Movimentações</option>
                            <option value="valor">Valor em Estoque</option>
                            <option value="frequencia">Frequência de Uso</option>
                            <option value="gastos">Gastos Mensais</option>
                        </select>
                    </div>
                    <div class="form-group" id="periodoField">
                        <label for="relatorioPeriodo">Período</label>
                        <select id="relatorioPeriodo">
                            <option value="7">Últimos 7 dias</option>
                            <option value="30">Últimos 30 dias</option>
                            <option value="90">Últimos 90 dias</option>
                            <option value="365">Últimos 365 dias</option>
                        </select>
                    </div>
                    <div class="form-group" id="mesField" style="display: none;">
                        <label for="relatorioMes">Mês</label>
                        <select id="relatorioMes">
                            <option value="1">Janeiro</option>
                            <option value="2">Fevereiro</option>
                            <option value="3">Março</option>
                            <option value="4">Abril</option>
                            <option value="5">Maio</option>
                            <option value="6">Junho</option>
                            <option value="7">Julho</option>
                            <option value="8">Agosto</option>
                            <option value="9">Setembro</option>
                            <option value="10">Outubro</option>
                            <option value="11">Novembro</option>
                            <option value="12">Dezembro</option>
                        </select>
                    </div>
                    <div class="form-group" id="anoField" style="display: none;">
                        <label for="relatorioAno">Ano</label>
                        <select id="relatorioAno">
                            <option value="2023">2023</option>
                            <option value="2024">2024</option>
                            <option value="2025">2025</option>
                        </select>
                    </div>
                </div>
                
                <button class="btn" onclick="gerarRelatorio()">Gerar Relatório</button>
                
                <div class="table-container" id="relatorioResultado" style="margin-top: 20px;">
                    <!-- Resultados do relatório serão exibidos aqui -->
                </div>
            </div>
            
            <!-- Gerenciar Usuários -->
            <div class="module" id="usuarios">
                <h2>Gerenciar Usuários</h2>
                <div class="form-row">
                    <div class="form-group">
                        <label for="novoUsuario">Nome do Novo Usuário</label>
                        <input type="text" id="novoUsuario" placeholder="Nome completo">
                    </div>
                    <div class="form-group">
                        <label for="novoUsuarioId">ID do Usuário</label>
                        <input type="number" id="novoUsuarioId" placeholder="Número de identificação">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="novoUsuarioTipo">Tipo de Usuário</label>
                        <select id="novoUsuarioTipo">
                            <option value="comum">Usuário Comum</option>
                            <option value="admin">Administrador</option>
                        </select>
                    </div>
                </div>
                
                <button class="btn" onclick="adicionarUsuario()">Adicionar Usuário</button>
                
                <h3 style="margin-top: 30px;">Usuários Cadastrados</h3>
                <div class="table-container">
                    <table id="tabelaUsuarios">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Nome</th>
                                <th>Tipo</th>
                                <th>Data de Criação</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Preenchido via JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Configurações -->
            <div class="module" id="configuracoes">
                <h2>Configurações do Sistema</h2>
                
                <div class="form-group">
                    <label for="emailNotificacao">E-mail para Notificações</label>
                    <input type="email" id="emailNotificacao" value="jlenon.32@outlook.com" placeholder="E-mail para receber alertas">
                </div>
                
                <div class="form-group">
                    <label for="diasAlertaVencimento">Dias para Alerta de Vencimento</label>
                    <input type="number" id="diasAlertaVencimento" value="30" min="1" max="365">
                </div>
                
                <div class="form-group">
                    <label for="limiteEstoqueBaixo">Limite para Estoque Baixo</label>
                    <input type="number" id="limiteEstoqueBaixo" value="10" min="1">
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="backupAuto">Backup Automático</label>
                        <select id="backupAuto">
                            <option value="diario">Diário</option>
                            <option value="semanal">Semanal</option>
                            <option value="mensal">Mensal</option>
                            <option value="desativado">Desativado</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="temaInterface">Tema da Interface</label>
                        <select id="temaInterface">
                            <option value="claro">Claro</option>
                            <option value="escuro">Escuro</option>
                            <option value="auto">Automático</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-row">
                    <button class="btn" style="flex: 1;" onclick="salvarConfiguracoes()">Salvar Configurações</button>
                    <button class="btn" style="flex: 1; background: var(--accent);" onclick="fazerBackup()">Fazer Backup Agora</button>
                </div>
            </div>
        </div>
    </div>
    <script src="script.js"></script>
</body>
</html>
